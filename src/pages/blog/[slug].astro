---
import { Image } from 'astro:assets';
import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '@/layouts/Layout.astro';
import CTA from '@/components/Cta.astro';
import { getWebPageSchema, getCombinedSchema } from '@/config/schemas';
import '@/styles/prose.css';
import BlogCard from '@/components/blog/BlogEntryCard.astro';

interface Props {
  post: CollectionEntry<'blog'>;
}

export async function getStaticPaths() {
  const posts: CollectionEntry<'blog'>[] = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.id.replace('.md', '') },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const title = `${post.data.title} | Kil√≥metros por Explorar`;
const description = post.data.description;
const pathname = Astro.url.pathname;

const pageSchema = getWebPageSchema(title, description, pathname);
const schema = getCombinedSchema(pageSchema);
---

<Layout title={title} description={description} schema={schema}>
  <main class="bg-white pt-20">
    <!-- Hero image -->
    <div class="mx-auto w-full max-w-5xl">
      <Image
        width="1200"
        height="600"
        src={post.data.image}
        alt={post.data.title}
        class="h-[240px] w-full object-cover md:h-[420px]"
        loading="eager"
      />
    </div>

    <!-- Content -->
    <div
      class="relative z-10 mx-auto -mt-12 max-w-4xl bg-white px-4 sm:px-6 md:-mt-16 lg:-mt-20 lg:px-8"
    >
      <!-- Header -->
      <header class="mb-8 pt-8 text-center md:pt-12">
        <div
          class="mb-4 flex flex-wrap items-center justify-center gap-4 text-neutral-600"
        >
          <span class="capitalize">{post.data.author}</span>
          <span> | </span>
          <time datetime={post.data.date.toISOString()}>
            {
              post.data.date.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })
            }
          </time>
        </div>
        <h1 class="text-3xl font-bold text-gray-900 md:text-4xl">
          {post.data.title}
        </h1>
      </header>

      <hr class="my-8 border-t border-gray-300 lg:my-16" />

      <!-- Article -->
      <article class="mx-auto prose mb-12 max-w-[800px] lg:prose-lg">
        <Content />
      </article>

      <hr class="my-8 border-t border-gray-300 lg:my-16" />
    </div>

    <CTA />
  </main>
</Layout>
