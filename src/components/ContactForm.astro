<form class="space-y-6" autocomplete="on">
  <div class="space-y-2">
    <label for="name" class="text-base font-medium text-gray-800"
      >Tu nombre*</label
    >
    <input
      type="text"
      id="name"
      name="name"
      placeholder="Introduce tu nombre"
      required
      class="focus:outline-primary mt-1 h-14 w-full rounded-xl border-0 bg-gray-100 px-4 text-gray-600 placeholder-gray-500"
    />
  </div>

  <div class="space-y-2">
    <label for="lastName" class="text-base font-medium text-gray-800"
      >Tus apellidos (opcional)</label
    >
    <input
      type="text"
      id="lastName"
      name="lastName"
      placeholder="Introduce tus apellidos"
      class="focus:outline-primary mt-1 h-14 w-full rounded-xl border-0 bg-gray-100 px-4 text-gray-600 placeholder-gray-500"
    />
  </div>

  <div class="space-y-2">
    <label for="email" class="text-base font-medium text-gray-800"
      >Tu email*</label
    >
    <input
      type="email"
      id="email"
      name="email"
      placeholder="Introduce tu email"
      required
      class="focus:outline-primary mt-1 h-14 w-full rounded-xl border-0 bg-gray-100 px-4 text-gray-600 placeholder-gray-500"
    />
  </div>

  <div class="space-y-2">
    <label for="phone" class="text-base font-medium text-gray-800"
      >Tu teléfono (opcional)</label
    >
    <input
      type="tel"
      id="phone"
      name="phone"
      placeholder="Introduce tu teléfono"
      class="focus:outline-primary mt-1 h-14 w-full rounded-xl border-0 bg-gray-100 px-4 text-gray-600 placeholder-gray-500"
    />
  </div>

  <div class="space-y-2">
    <label for="message" class="text-base font-medium text-gray-800"
      >Tu mensaje*</label
    >
    <textarea
      id="message"
      name="message"
      placeholder="Cuéntanos más sobre tu viaje ideal..."
      class="focus:outline-primary mt-1 field-sizing-content min-h-36 w-full rounded-xl border-0 bg-gray-100 px-4 py-4 text-gray-600 placeholder-gray-500"
      required></textarea>
  </div>

  <div class="flex items-center">
    <input
      id="privacy"
      name="privacy"
      type="checkbox"
      class="text-primary size-4 rounded border border-gray-600"
      required
    />
    <label for="privacy" class="ml-2 block text-sm text-gray-600">
      Acepto la <a
        href="/politica-de-privacidad-y-cookies"
        class="text-primary hover:underline">política de privacidad</a
      > y el tratamiento de mis datos
    </label>
  </div>

  <button
    type="submit"
    class="bg-primary hover:bg-primary/90 w-full rounded-xl px-4 py-3 font-bold text-white transition duration-300"
  >
    Enviar Consulta
  </button>
</form>

<script>
  const form = document.querySelector('form');
  const CONTACT_ENDPOINT = import.meta.env.PUBLIC_CONTACT_FORM_ENDPOINT;

  form?.addEventListener('submit', async event => {
    event.preventDefault();

    const formData = new FormData(form);
    const data = Object.fromEntries(formData);

    // Deshabilitar botón para evitar envíos múltiples
    const submitButton: HTMLButtonElement | null = form.querySelector(
      'button[type="submit"]'
    );
    const originalText = submitButton?.textContent || 'Enviar Consulta';

    if (submitButton) {
      submitButton.disabled = true;
      submitButton.textContent = 'Enviando...';
    }

    try {
      const response = await fetch(CONTACT_ENDPOINT, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      if (response.ok) {
        alert('Mensaje enviado con éxito. Revisa tu email.');
        form.reset();
      } else {
        const errorData = await response.json().catch(() => ({}));
        console.error('Error del servidor:', errorData);
        alert(
          'Ha ocurrido un error al enviar el formulario. Por favor, inténtalo de nuevo o contáctanos por teléfono.'
        );
      }
    } catch (error) {
      console.error('Error de red:', error);
      alert(
        'Error de conexión. Por favor, verifica tu conexión a internet e inténtalo de nuevo.'
      );
    } finally {
      // Rehabilitar botón
      if (submitButton) {
        submitButton.disabled = false;
        submitButton.textContent = originalText;
      }
    }
  });
</script>
