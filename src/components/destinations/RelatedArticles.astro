---
import { getCollection } from 'astro:content';
import BlogCard from '@/components/BlogCard.astro';
import type { CollectionEntry } from 'astro:content';

interface Props {
  destination: CollectionEntry<'destinations'>;
}

const { destination } = Astro.props;

const posts = await getCollection('blog', ({ data }) => {
  return data.destinations?.includes(destination.id.replace('.md', ''));
});
const sortedPosts = posts.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---

<section class="mx-auto max-w-7xl px-4 pt-4">
  <h2 class="mt-12 mb-4 text-2xl font-bold text-gray-800">
    Artículos Relacionados
  </h2>

  {
    sortedPosts.length > 0 ? (
      <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
        {sortedPosts.map(post => (
          <BlogCard post={post} loading="lazy" />
        ))}
      </div>
    ) : (
      <p class="text-gray-600">
        Parece que aún no tenemos ningún artículo para este destino. Échale un
        vistazo a{' '}
        <a href="/blog" class="text-primary hover:underline">
          nuestro blog
        </a>{' '}
        o explora{' '}
        <a href="/destinos" class="text-primary hover:underline">
          más destinos<span class="text-gray-600">.</span>
        </a>
      </p>
    )
  }
</section>
